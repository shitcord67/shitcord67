# shitcord67 (Discord-lookalike MVP)

A lightweight Discord-style chat client prototype with local persistence.

![shitcord67 UI screenshot](Screenshot.png)

## Run (Linux)
1. Open `index.html` in a browser.
2. Optional local server:
   - `python3 -m http.server 8080`
   - open `http://localhost:8080`

## Implemented
- Login by username (creates/switches local accounts).
- Bottom-left account dock with avatar, display name, status, and settings gear.
- Full-screen user settings page (Discord-style categories: My Account, Profiles, Appearance, Advanced).
- Create guilds and channels.
- Guild creation now supports template presets (friends/gaming/community/study/blank) with optional starter channels.
- Guild settings dialog supports rename, description, accent color, and admin-gated delete flow.
- Channel topics with inline edit control in chat header.
- Send messages as current user.
- Message actions: reply, edit, delete.
- Edited-message indicator (`(edited)`).
- Slash commands with live autocomplete popup (`/help`, `/me`, `/shrug`, `/note`, `/topic`, `/slowmode`, `/rename`, `/channelinfo`, `/whereami`, `/jumpunread`, `/nextunread`, `/prevunread`, `/unreadcount`, `/pins`, `/unpinall`, `/clear`, `/nick`, `/status`, `/markread`, `/mediaprivacy`, `/trustdomain`, `/untrustdomain`, `/tableflip`, `/unflip`, `/lenny`, `/roll`, `/timestamp`).
- Send-later workflow: `/schedule <when> | <text>`, `/scheduled`, `/unschedule <id|last|all>` (channels and DMs).
- `@mention` autocomplete popup with keyboard and mouse selection.
- Lightweight emoji reactions on messages.
- Inline image URL preview for common image links.
- Pin/unpin messages per channel, with a pinned-messages panel.
- Guild rail now scrolls as one native-feeling column (brand, guild icons, and `+` create button).
- Unread + mention badges for channels and guilds, with per-account read tracking.
- Quick channel filter input in the sidebar.
- Discord-like media picker panel in the composer (tabs: GIFs, Stickers, Emojis, SWFs, SVGs, PDFs, Text, Docs, HTML).
- Click-to-send media attachments from picker (GIF/sticker/SVG/SWF), including local SWF index support via `swf-index.json`.
- GIF video attachments autoplay/loop in chat.
- Sticker picker supports image stickers plus `.apng` and `.lottie` resources.
- Ruffle and dotLottie runtimes are auto-loaded by the app (no manual user install flow).
- Guild-scoped custom emoji (image-based) and custom sticker/media resources can be added from URL or local file.
- Debug Console in Advanced settings (runtime status + recent media/ruffle logs).
- Message context menu can copy payload as JSON or Matrix-style XML.
- Message context menu copy actions now include author/timestamp/attachment URL helpers.
- Message context menu includes edit-history actions (`View Edit History`, copy history JSON).
- Message context menu shows SWF actions only when that message has SWF attachments.
- SWF message actions are grouped under a dedicated `SWF` submenu (open viewer/fullscreen/reset/save/copy URL/download).
- SWFs auto-start in chat muted and are paused/resumed based on viewport visibility.
- SWF controls include `Play`, `Pause`, `FullScreen`, `Reset` (with confirmation), `Resize`, and `Optimal Size`.
- Per-SWF audio controls are shown on the left side of each SWF player (speaker toggle + vertical volume slider).
- SWF cards include a top-right `ðŸ’¾` save icon in the filename row for quick save-to-shelf.
- SWF cards show a live audio status badge (`Audio Active`, `Suppressed`, `Muted`), and right-clicking the speaker pins audio to skip auto-mute.
- Advanced settings include SWF audio policy options: single-audio or multi-audio, with global or per-guild focus scope.
- SWF audio focus prefers the SWF nearest the center of the viewport, with fullscreen SWFs prioritized.
- Advanced SWF options include default autoplay/paused mode, pause-on-auto-mute behavior, and optional collapsible VU details.
- SWF top controls are in the header row (save, play/pause, fullscreen, reset, resize, optimal size, solo focus, PiP).
- Tabbed SWF PiP dock lets you keep selected SWFs open while switching guilds/channels.
- SWF picker now supports muted Ruffle previews with lightweight sampled frame playback.
- SWF link opens are configured with confirmation prompts (`openUrlMode: "confirm"`).
- Advanced settings now include dedicated `Export SWF Saves` / `Import SWF Saves` (browser local-storage based).
- SVG attachments in chat include a direct `Download SVG` action.
- PDF links/attachments render inline in chat with open-in-tab fallback.
- Media picker includes dedicated `PDFs`, `Text`, and `Docs` tabs for guild-scoped resources (URL or local file import).
- Composer `+` button opens the media picker, while `ðŸ“Ž` opens system file upload (PDF/Text/Docs/BIN).
- Right-click `+` opens file upload directly; right-click `ðŸ“Ž` jumps to the PDF picker tab.
- Composer has dedicated quick buttons for GIF, Sticker, and Emoji picker tabs.
- Drag and drop or clipboard paste of supported files (`.pdf`, text, OpenDocument, RTF, `.bin`) attaches them to composer; press `Enter` to send.
- Audio links/attachments render with native playback controls.
- Plain-text/code links (`.txt/.md/.json/.js/.css/...`) render inline preview snippets.
- RTF attachments render as inline plain-text previews.
- OpenDocument/Office attachments render in an inline frame with open/download fallback links.
- Binary (`.bin`) attachments render a compact HEX preview in chat.
- PDF attachments now always include open/download controls plus a fallback note for browsers with inline PDF viewing disabled.
- Keyboard shortcuts: `Ctrl+Shift+G/S/E` open GIF/Sticker/Emoji tabs, `Alt+O` opens PDF tab, `Alt+U` opens file attach.
- Extra channel shortcuts: `Alt+I` opens pins, `Alt+R` marks current channel read, `Alt+N/P` jumps unread channels, `Alt+ArrowUp/Down` navigates channels.
- Section visibility shortcuts: `Alt+Shift+D` collapses/expands DM section, `Alt+Shift+C` collapses/expands guild channel section.
- Quick switcher shortcut: `Ctrl+K` (or `Cmd+K`) opens channel/DM/guild quick jump modal.
- Find shortcut: `Ctrl+F` (or `Cmd+F`) opens "Find in conversation" with hit highlighting and jump.
- Find navigation shortcuts: `F3` / `Shift+F3` and `Ctrl+G` / `Shift+Ctrl+G` jump between matches.
- Channel reorder shortcut: `Ctrl+Alt+ArrowUp/Down` moves active channel (manage channels permission).
- Channel quick-jump shortcuts: `Alt+Home`/`Alt+End` jump to first/last channel.
- Quick creation shortcuts: `Ctrl+Shift+N` opens create-channel, `Ctrl+Shift+D` opens new-DM prompt.
- Read-state shortcuts: `Alt+Shift+R` marks current conversation read, `Alt+Shift+A` marks all read.
- Guild notification shortcut: `Alt+Shift+G` cycles `all -> mentions -> mute`.
- Additional quick nav shortcuts: `Alt+1/2/3` open GIF/Sticker/Emoji tabs and `Ctrl+Shift+F` focuses channel/DM filter.
- Guild channel rows now render dedicated channel-type icons with stronger active/hover states.
- DM sidebar rows now render peer avatars + presence dots.
- DM mode now has a dedicated home screen (`Friends`) when no DM thread is selected.
- Member panel title now shows live member count for the active guild/DM.
- Chat message list includes day separators and full timestamp tooltips on hover.
- Guild channels with unread messages show a sticky unread banner with quick `Mark read` and `Jump` actions.
- Chat header includes `Next Unread` with live unread-channel count and quick jump behavior.
- Added floating `Jump to present` button when scrolled up, including count of messages below viewport.
- Collapsible sidebars: header buttons toggle channel/member panels, with persisted visibility state.
- Sidebar layout shortcuts: `Ctrl+Shift+B` toggles channels, `Ctrl+Shift+M` toggles members.
- Quick composer focus shortcut: `Ctrl+Shift+L`.
- Composer ergonomics: `ArrowUp` in empty composer opens editor for your latest editable message.
- Composer newline/send behavior: `Enter` sends, `Shift+Enter` inserts newline.
- Composer also supports `Ctrl+Enter` (or `Cmd+Enter`) to send.
- Composer clear shortcut: `Ctrl+Shift+Backspace` clears text + reply target + pending attachment.
- Composer now supports multi-attachment queues (up to 6 files), with chip-based remove and bulk save-to-picker.
- File attach/paste/drag-drop now supports richer media types (images/video/audio/SWF/SVG/HTML + docs/text/PDF/bin).
- New draft utility commands: `/drafts`, `/cleardrafts [all]`, `/focus [search|composer]`.
- Find commands: `/find [query]`, `/findnext`, `/findprev`.
- New conversation admin commands: `/newdm <username>`, `/closedm`, `/leaveguild`.
- Additional channel/reading commands: `/newchannel <name> [type]`, `/dupchannel`, `/movechannel <up|down|top|bottom>`, `/markdmread`, `/markallread`.
- Unread command: `/markunread [message-id-prefix|last]` marks current conversation unread from a specific message.
- Identity/engagement commands: `/quests` shows activity badges and `/profilefx <none|aurora|flame|ocean>` sets profile effects.
- Copy/notification commands: `/copylink`, `/copyid`, `/copytopic`, `/notify [status|all|mentions|mute]`.
- Channel/DM rows now show `Draft` badges for unsent composer drafts.
- Right-click DM home icon allows `Mark All DMs Read`.
- Right-click DM/Channel section headers now opens quick actions (`New DM`, `Create Channel`, `Mark Read`).
- Browser autocomplete hints for login/search/composer inputs are disabled to avoid slash-command suggestion overlap.
- Runtime anti-autocomplete hardening now also applies to find/quick-switch/media-search fields.
- Browser tab title now shows unread/mention badges for quick background awareness.
- Reload/close warns if the composer has unsent text, reply state, or pending attachment.
- Composer `Escape` now cancels active reply target when input is empty.
- Channel/DM search ergonomics: `Escape` clears active filter/search quickly.
- DM list is now sorted by latest message activity.
- DM rows include one-line last-message previews.
- Guild member lists are sorted alphabetically inside Online/Offline groups.
- Member panel now includes live member search + presence filters (`All/Online/Offline`) and role badges.
- Extra media hotkeys: `Alt+4/5/6/7/8/9` open PDF/Text/Docs/HTML/SWF/SVG tabs.
- Message rows support double-click to start reply quickly.
- Reply preview lines can jump to the referenced message in-view.
- `Shift+Click` on a message timestamp copies its raw timestamp.
- Message context menu copy submenu includes `Timestamp (local)`.
- Edit dialog quality-of-life: autofocus/select on open, `Ctrl+Enter` to save, `Escape` to cancel.
- Added shortcuts help dialog in-app (`Shortcuts` header button), with hotkeys `Ctrl+/` and `Alt+0` to open.
- Added `/shortcuts` slash command to open the shortcuts dialog.
- Message actions now include `Quote` to append quote-formatted text into composer.
- Message copy helpers include `Markdown Quote`.
- Message copy helpers now include a generated message permalink.
- Message permalinks with `#msg=<conversationId>:<messageId>` auto-navigate and highlight when possible.
- Emoji picker search now matches aliases/keywords and supports colon-style query terms (`:fire:`).
- Emoji recents are persisted and prioritized in picker ordering.
- Using emoji in picker/reactions updates recent emoji history.
- Spoiler formatting with `||text||` now renders as click-to-reveal hidden text.
- New `/spoiler <text>` slash command sends spoiler-formatted messages quickly.
- New `/poll <question> | <option1> | <option2> ...` slash command creates Telegram-style quick polls.
- Poll cards support live voting, selected-state highlighting, unique voter counts, and close/reopen controls.
- Poll results can be copied from message context menu (`Copy Poll Results`) and posted with optional voter list via `/pollresults voters`.
- Composer shortcut `Ctrl+Shift+O` wraps selected text (or current word) in spoiler markers.
- Composer drafts are persisted per channel/DM and restored when switching conversations or refreshing.
- Composer footer now shows character usage (`0/400`) with near-limit warnings.
- Announcement channels are read-only for non-moderators (permission notice shown in composer).
- Per-channel slowmode is supported (channel settings, context-menu presets, and `/slowmode` slash command).
- Header now includes a direct `Mark Read` action and live pinned-message count on the `Pins` button.
- Header now includes a direct `Find` action button for conversation search.
- Discord-like visual tuning pass applied (font stack, channel row states, header controls, message spacing, member-list hover treatment).
- Composer input bar now uses compact Discord-style action sizing with arrow send button treatment.
- Composer has a quick SWF audio toggle button (`ðŸ”‡`/`ðŸ”Š`) next to the media `+` button.
- Clicking an SWF player promotes it to active audio focus (unless that SWF is explicitly muted).
- Composer SWF audio button is now 3-state: `click-to-hear` (default), `auto-on`, and `force-muted` (right-click).
- SWF floppy button now downloads the SWF file; right-click on it saves to SWF shelf.
- SWF picker previews are initialized after DOM mount to avoid detached-Ruffle playback warnings.
- Hovering/focusing the media `+` button pre-warms media runtimes (Ruffle/dotLottie) for faster picker previews.
- Media picker uses a 2-column masonry-style flow with better aspect-ratio preservation for preview media.
- SWF picker previews are non-interactive (overlay captures click-to-send), and preview players are pointer-disabled/muted.
- Each SWF card top bar includes quick SWF save import/export buttons (`â‡§`/`â‡©`) next to the floppy control.
- SWF save import/export targets browser-local Ruffle save storage keys on this origin (web mode), not desktop file-system paths.
- SWF Shelf lets you keep selected SWFs saved for quick reopen across channels.
- In-chat SWF cards now have a `Resize` mode for drag-resizing the player area.
- Basic per-guild role and permission system (create/assign roles, channel/topic/role management gates).
- If a guild has no administrator assigned yet, the first active member is auto-granted an `Owner` admin role.
- Channel settings dialog (rename/delete with permission checks).
- Profile customization: display name, bio, custom status, presence, avatar color/image URL, banner color/image URL.
- Profile identity extras: avatar decoration emoji, guild tag, profile effect, and optional nameplate SVG/URL.
- Click usernames in chat to open profile popouts.
- Click members in the right sidebar to open profile popouts.
- Right-click context menus for guilds, channels, messages, and members (quick actions).
- Context menu keyboard controls include arrow navigation, `Enter`, `Escape`, plus `Home`/`End` and `ArrowRight`/`ArrowLeft` submenu control.
- Message rows now support keyboard context menus (`Shift+F10` or `ContextMenu` key).
- SWF context actions show inline toast feedback for copy/download/save outcomes.
- Forum thread toolbar includes a `Mark all threads read` bulk action.
- Forum channels support native tag sets and filtering (`/forumtag`, `/tagthread`) with clickable tag chips in the forum toolbar.
- Messages that mention you (or reply to your message) now get Discord-like highlighted row styling.
- Keyboard shortcuts: `Alt+K` focus current search, `Ctrl+,` open settings, `Alt+D` toggle DM/guild mode.
- External HTTP(S) media uses a privacy gate (safe mode) with two-click load options and trust rules (exact domain, `*.wildcard`, `/regex/`).
- Collaborative `shared` messages can be created with `/note` and edited by members.
- Message edits keep a history trail; moderator edits are labeled as `edited by staff`.
- Popouts/dialogs close by clicking outside the card content.
- Guild member list on the right, with presence dots.
- Member list grouped into Online/Offline sections.
- Role badges are shown on user profile popouts for the active guild.
- Account switching popup and logout.
- JSON export/import from Advanced settings for snapshot backup/restore.
- Persisted state in `localStorage` (`shitcord67-state-v1`, with migration from `flashcord-state-v2` and `flashcord-state-v1`).
- Login/settings/chat views are now viewport-isolated (no page-level scroll between app sections).

## Files
- `index.html`: app shell and dialogs.
- `styles.css`: Discord-inspired layout and theme.
- `app.js`: state, rendering, actions, persistence.
- `TODO`: roadmap for XMPP/Matrix and advanced features.
- `swf-index.json`: searchable local SWF catalog for the picker.

## Debugging
- Open browser DevTools and inspect `localStorage` key `shitcord67-state-v1`.
- Clear/reset state by deleting `shitcord67-state-v1` (or old `flashcord-state-v2` / `flashcord-state-v1`) and refreshing.

## Ruffle Save Notes
- In browser mode, SWF save data is stored by the browser in site storage/local storage (not as normal files on disk).
- In desktop Ruffle mode, files are stored by platform:
  - Linux (Flatpak): `~/.var/app/rs.ruffle.Ruffle/data/ruffle/SharedObjects/`
  - Linux (non-Flatpak): `~/.local/share/ruffle/SharedObjects/`
  - macOS: `/Users/<username>/Library/Application Support/ruffle/SharedObjects/`
  - Windows: `C:\\Users\\<username>\\AppData\\Local\\Ruffle\\SharedObjects\\`

## Next architecture step
Add a transport adapter layer so UI logic stays independent from protocol backends (local JSON, XMPP, Matrix).
